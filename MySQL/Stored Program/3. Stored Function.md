-----
### μ¤ν† μ–΄λ“ ν•¨μ (Stored Function)
-----
1. μ‚¬μ©μκ°€ μ§μ ‘ λ§λ“¤μ–΄μ„ μ‚¬μ©ν•λ” ν•¨μ
2. μ¤ν† μ–΄λ“ ν”„λ΅μ‹μ €μ™€ μ μ‚¬ν•μ§€λ§, ν•νƒμ™€ μ‚¬μ© μ©λ„μ— μ•½κ°„μ μ°¨μ΄κ°€ μμ
3. λ‹¤λ¥Έ DBMSμ—λ” μ¤ν† μ–΄λ“ ν”„λ΅μ‹μ €λ¥Ό μ €μ¥ ν”„λ΅μ‹μ €, μ¤ν† μ–΄λ“ ν•¨μλ¥Ό μ‚¬μ©μ μ •μ ν•¨μλΌκ³ λ„ λ¶€λ¦„
4. κΈ°λ³Έ μ •μ
```sql
CREATE
    [DEFINER = user]
    FUNCTION sp_name ([proc_parameter[,...]])
    [characteristic ...] routine_body

func_parameter:
    param_name type

type:
    Any valid MySQL data type

characteristic: {
    COMMENT 'string'
  | LANGUAGE SQL
  | [NOT] DETERMINISTIC
  | { CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA }
  | SQL SECURITY { DEFINER | INVOKER }
}

routine_body:
    Valid SQL routine statement
```
  - κ°„λ‹¨ν•κ² ν‘ν„
```sql
DEMITIER $$

CREATE FUNCTION μ¤ν† μ–΄λ“_ν•¨μμ΄λ¦„(νλΌλ―Έν„°)
    RETURNS λ°ν™ν•μ‹

BEGIN

    μ΄ λ¶€λ¶„μ— ν”„λ΅κ·Έλλ° μ½”λ”©
    RETURN λ°ν™κ°’

END $$

DELIMITER ;

SELECT μ¤ν† μ–΄λ“_ν•¨μμ΄λ¦„();
```

5. μ¤ν† μ–΄λ“ ν•¨μμ™€ μ¤ν† μ–΄λ“ ν”„λ΅μ‹μ €μ μ°¨μ΄μ 
   - π’΅ μ¤ν† μ–΄λ“ ν”„λ΅μ‹μ €μ νλΌλ―Έν„°μ™€ λ‹¬λ¦¬ IN, OUT λ“± μ‚¬μ© λ¶κ°€ : μ¦‰, μ¤ν† μ–΄λ“ ν•¨μμ νλΌλ―Έν„°λ” λ¨λ‘ μ…λ ¥ νλΌλ―Έν„°λ΅ μ‚¬μ©
   - π’΅ μ¤ν† μ–΄λ“ ν•¨μλ” RETURNSλ¬ΈμΌλ΅ λ°ν™ν•  κ°’μ λ°μ΄ν„° ν•μ‹ μ§€μ •, λ³Έλ¬Έ μ•μ—μ„λ” RETURN λ¬ΈμΌλ΅ ν•λ‚μ κ°’μ„ λ°ν™
     + π’΅μ¤ν† μ–΄λ“ ν”„λ΅μ‹μ €λ” λ³„λ„μ λ°ν™ν•λ” κµ¬λ¬Έ μ—†μ΄, κΌ­ ν•„μ”ν•λ‹¤λ©΄ μ—¬λ¬ κ°μ OUT νλΌλ―Έν„°λ¥Ό μ‚¬μ©ν•΄μ„ κ°’ λ°ν™ κ°€λ¥
   - π’΅ μ¤ν† μ–΄λ“ ν”„λ΅μ‹μ €λ” CALLλ΅ νΈμ¶ν•μ§€λ§, μ¤ν† μ–΄λ“ ν•¨μλ” SELECT λ¬Έμ¥ μ•μ—μ„ νΈμ¶
   - π’΅ μ¤ν† μ–΄λ“ ν”„λ΅μ‹μ € μ•μ—λ” SELECTλ¥Ό μ‚¬μ©ν•  μ μμ§€λ§, μ¤ν† μ–΄λ“ ν•¨μ μ•μ—λ” μ§‘ν•© κ²°κ³Όλ¥Ό λ°ν™ν•λ” SELECT μ‚¬μ© λ¶κ°€
     + π’΅SELECT ... INTOλ” μ§‘ν•© κ²°κ³Ό λ°ν™μ΄ μ•„λ‹λ―€λ΅, μ¤ν† μ–΄λ“ ν•¨μμ— μμ™Έμ  μ‚¬μ© κ°€λ¥
   - π’΅ μ¤ν† μ–΄λ“ ν”„λ΅μ‹μ €λ” μ—¬λ¬ SQLλ¬Έμ΄λ‚ μ«μ κ³„μ‚° λ“±μ μ©λ„λ΅ μ‚¬μ©λμ§€λ§, μ¤ν† μ–΄λ“ ν•¨μλ” μ–΄λ– ν• κ³„μ‚°μ„ ν†µν•΄ ν•λ‚μ κ°’μ„ λ°ν™ν•λ” λ° μ£Όλ΅ μ‚¬μ©

6. μ¤ν† μ–΄λ“ ν•¨μ μ‚¬μ©μ„ μ„ν•΄ λ‹¤μ μΏΌλ¦¬λ¬ΈμΌλ΅ μ¤ν† μ–΄λ“ ν•¨μ μƒμ„± κ¶ν• ν—μ©
```sql
SET GLOBAL log_bin_trust_function_creators = 1;
```

7. μμ ) κ°„λ‹¨ν 2κ°μ μ«μμ ν•©κ³„λ¥Ό κ³„μ‚°ν•λ” μ¤ν† μ–΄λ“ ν•¨μ
```sql
USER sqlDB;
DROP FUNCTION IF EIXST userFunc;

DELIMITER $$
CREATE FUNCTION userFunc(value INT, value2 INT) -- 2κ°μ μ •μν• νλΌλ―Έν„° μ „λ‹¬
    RETURNS INT -- μ΄ ν•¨μκ°€ λ°ν™ν•λ” λ°μ΄ν„° ν•μ‹ μ§€μ •

BEGIN
  RETURN value1 + value2; -- μ •μν• λ°ν™ (RETURN)
END $$

DELIMITER ;
```
```sql
SELECT userFunc(100, 200); -- ν•¨μλ¥Ό νΈμ¶ν•λ©΄μ„ 2κ°μ νλΌλ―Έν„° μ „λ‹¬
```

8. μμ ) μ¶μƒλ…„λ„λ¥Ό μ…λ ¥ν•λ©΄ λ‚μ΄κ°€ μ¶λ ¥λλ” ν•¨μ
   - sqlDB.sqlλ¥Ό μ΄μ©ν•΄ sqlDB λ°μ΄ν„°λ² μ΄μ¤ μ΄κΈ°ν™”
   - μ¶μƒλ…„λ„λ¥Ό μ…λ ¥ν•λ©΄ λ‚μ΄κ°€ μ¶λ ¥λλ” ν•¨μ
```sql
USE sqlDB;
DROP FUNCTION IF EXISTS getAgeFunc;

-- μ¶μƒλ…„λ„λ¥Ό λ°›μ•„μ„ ν„μ¬ λ‚μ΄λ¥Ό λ°ν™ν•λ” ν•¨μ
DELIMITER $$

CREATE FUNCTION getAgeFunc(bYear INT)
    RETURNS INT

BEGIN

    DECLARE age INT;
    SET age = YEAR(CURDATE()) - bYear;
    RETURN age;

END $$
DELIMITER ;
```
  - ν„μ¬μ μ—°λ„(YEAR(CURDATE())μ—μ„ μ…λ ¥λ μ¶μƒλ…„λ„λ¥Ό λΊ€ κ°’(μ¦‰, λ‚μ΄) λ°ν™

  - ν•¨μ νΈμ¶
  - SELECTλ¬Έ μ‚¬μ©
```sql
-- μ‚¬μ©
SELECT getAgeFunc(1979);
```

  - π’΅ ν•„μ”ν•λ‹¤λ©΄ ν•¨μμ λ°ν™κ°’μ„ SELECT ... INTOλ΅ μ €μ¥ν–λ‹¤κ°€ μ‚¬μ© κ°€λ¥
```sql
-- ν•¨μμ κ²°κ³Όλ¥Ό λ³€μλ΅ μ €μ¥
SELECT getAgeFunc(1979) INTO @age1979;
SELECT getAgeFunc(1997) INTO @age1997;

-- λ‚μ΄μ°¨μ΄
SELECT CONCAT('1997λ…„κ³Ό 1979λ…„μ λ‚μ΄μ°¨ ==> ', (@age1979-@age1997));
```

  - λ‘ μ¶μƒλ…„λ„μ λ‚μ΄ μ°¨ μ¶λ ¥
  - ν•¨μλ” μ£Όλ΅ ν…μ΄λΈ”μ„ μ΅°νν•  λ• ν™μ©
```sql
-- λ§ λ‚μ΄λ¥Ό μ¶λ ¥
SELECT userID, name, getAgeFunc(birthYear) AS 'λ§ λ‚μ΄' FROM userTBL;
```
<div algin="center">
<img src="https://github.com/user-attachments/assets/b3d5c128-b254-467e-9b29-0c8b3f01e54c">
</div>

  - ν„μ¬ μ €μ¥λ μ¤ν† μ–΄λ“ ν•¨μμ μ΄λ¦„ λ° λ‚΄μ© ν™•μΈ : SHOW CREATE FUNCTIONλ¬Έ
```sql
-- ν•¨μμ λ‚΄μ© λ³΄κΈ°
SHOW CREATE FUNCTION getAgeFunc;
```

  - μ‚­μ λ” λ‹¤λ¥Έ λ°μ΄ν„°λ² μ΄μ¤ κ°μ²΄μ™€ λ™μΌν•κ² DROPλ¬Έ μ‚¬μ©
```sql
-- ν•¨μ μ‚­μ 
DROP FUNCTION getAgeFunc;
```


