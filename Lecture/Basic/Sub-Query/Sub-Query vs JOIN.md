-----
### 서브쿼리 vs JOIN
-----
1. 서울에 거주하는 모든 고객들의 주문 목록을 조회하기
   - 해결 방법 1 : 서브쿼리 사용
     + 먼저, 서울에 사는 고객들의 user_id 목록을 찾음 (users 테이블).
     + 그다음, 이 user_id 목록에 포함된 order_id를 가진 주문들을 찾음 (orders 테이블).
```sql
SELECT o.order_id, o.user_id, o.product_id, o.order_date
FROM orders o
WHERE o.user_id IN (SELECT user_id FROM users WHERE address LIKE '서울%');
```
   - 이 쿼리는 읽기가 매우 쉬움
<div align="center">
<img src="https://github.com/user-attachments/assets/6d400e5f-2c39-4514-901c-fbbc00d6b78c">
</div>

   - 해결 방법 2: JOIN 사용
      + JOIN 을 이용한 접근법은 필요한 테이블들을 일단 모두 연결한 뒤, 원하는 조건을 필터링하는 방식
```sql
SELECT o.order_id, o.user_id, o.product_id, o.order_date
FROM orders o
JOIN users u ON o.user_id = u.user_id
WHERE u.address LIKE '서울%';
```
<div align="center">
<img src="https://github.com/user-attachments/assets/0b765cd9-b1c3-4619-bd80-d8953ac7f6b5">
</div>

2. 💡 성능 vs 가독성 : 실무 가이드
   - 성능 (Performance)
      + 일반적으로, 데이터베이스는 JOIN이 서브쿼리보다 성능이 더 좋거나 최소한 동일한 경우가 많음
      + 데이터베이스의 '두뇌' 역할을 하는 쿼리 옵티마이저(Query Optimizer)
         * JOIN 구문은 옵티마이저에게 더 많은 정보를 제공 : "A와 B 테이블을 특정 조건으로 연결해야 한다"는 전체 그림을 미리 보여주기 때문에, 옵티마이저는 인덱스를 어떻게 활용하고 어떤 테이블을 먼저 읽을지 등 가장 효율적인 실행 계획을 선택할 수 있는 더 넓은 선택지를 가짐
         * 반면, 서브쿼리는 (특히 과거의 데이터베이스에서는) 단계적으로 실행되는 경우가 많았음 : 서브쿼리를 먼저 실행해서 나온 결과를 메모리에 담아두고, 그 다음 메인쿼리가 그 결과를 참조하는 방식으로 동작하여 비효율을 야기할 수 있었음
      + 그러나, 요즘 데이터베이스의 옵티마이저는 매우 똑똑해져서, 간단한 IN 서브쿼리는 내부적으로 최적의 JOIN 구문으로 자동 변환해서 실행하는 경우가 많음
      + 따라서 위 예제의 두 쿼리는 사실상 동일한 성능을 낼 확률이 높음
      + 참고로 이런 최적화는 항상 가능한 것은 아니기 때문에 쿼리 실행 계획 등을 확인하는 것이 좋음

    - 가독성 (Readability)
      + 가독성은 주관적인 영역이지만, 쿼리의 유지보수 측면에서 성능만큼이나 중요
      + 서브쿼리는 쿼리의 논리적 단계를 명확하게 구분해 주어, 복잡한 로직을 더 이해하기 쉽게 만들어주는 경우가 많음
      + JOIN은 쿼리에 필요한 모든 데이터 소스를 한눈에 보여주고, 여러 테이블의 컬럼을 함께 조회해야 할 때는 구조적으로 더 깔끔

3. 최종 결론 : 언제 무엇을 써야 할까?
    - 정답은 없지만 하지만 실무에서 적용할 수 있는 가이드라인은 다음과 같음
    - JOIN 을 우선적으로 고려 : 일반적인 성능 우위와 범용성을 고려할 때, 문제를 해결할 방법을 JOIN 에서 먼저 찾아보는 것이 좋은 출발점
    - JOIN 으로 표현하기 너무 복잡하거나, 서브쿼리의 가독성이 훨씬 좋다면 서브쿼리를 사용
      + 성능이 아주 중요한 쿼리가 아니라면, 이해하기 쉬운 코드를 작성하는 것이 장기적으로 더 가치 있을 수 있음
      + 특히 인라인 뷰를 사용해야만 깔끔하게 풀리는 문제는 서브쿼리가 정답
    - EXISTS를 활용 : IN 서브쿼리의 대안으로, EXISTS라는 서브쿼리 연산자도 있음
      + XISTS 는 서브쿼리의 결과값이 존재하는지 여부만 체크하기 때문에, 특정 상황에서 더 효율적으로 동작하기도 함
    - 성능이 의심될 때는 반드시 측정
      + 가장 중요한 원칙으로, 추측하지 말고, EXPLAIN 과 같은 도구를 사용해 데이터베이스가 어떻게 쿼리를 실행하는지 계획을 분석하고, 실제 실행 시간을 측정하여 더 나은 방법을 선택해야 함

4. JOIN과 서브쿼리는 대립하는 기술이 아니라, 데이터라는 재료를 요리하는 두 가지 필수 도구로, 각각의 장단점을 이해하고 상황에 맞게 꺼내 사용할 수 있어야 함
