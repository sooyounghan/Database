-----
### 다대다(M:N) 관계 - 관계형 모델의 한계
-----
1. 이 관계는 '하나의 주문은 여러 상품을 담을 수 있고, 하나의 상품은 여러 주문에 포함될 수 있다'와 같은 매우 흔한 비즈니스 상황을 모델링
2. 다대다 관계를 이해하고 올바르게 설계하는 것은 데이터 모델링의 핵심 역량 중 하나
   - 하지만 놀랍게도, 관계형 데이터베이스는 테이블 두 개만으로 다대다(M:N) 관계를 표현할 수 없음

3. 관계형 데이터베이스의 기본 제약 : 관계형 데이터베이스에서 테이블의 행(row)은 다음과 같은 특징을 가짐
   - 기본 키(PK)는 반드시 유일 : 한 테이블 안에서 동일한 PK를 가진 행은 존재할 수 없음
   - 외래 키(FK)는 단일 행만 참조 : 외래 키 값 하나는 상대 테이블의 정확히 한 행만 가리킴
   - 컬럼은 원자적(atomic)이어야 함 : 하나의 컬럼에 여러 값을 넣을 수 없음 (제 1 정규형)

4. 두 테이블로 다대다 관계 시도
   - 다대다 관계에서 사용하는 예시
<div align="center">
<img src="https://github.com/user-attachments/assets/e3535422-d3ec-43fe-b2f5-9908464e2d6e">
</div>

   - 100번 주문이 청바지(1), 티셔츠(2)라는 상품을 둘 다 주문
   - 101번 주문이 청바지(1) 상품을 주문
   - 하나의 주문은 여러 상품을 주문할 수 있음
     + 100번 주문은 청바지(1), 티셔츠(2)를 주문
  - 하나의 상품은 여러 주문에 포함될 수 있음
     + 청바지(1) 상품은 100번, 101번 주문에 포함
  - 따라서 주문과 상품은 다대다 관계

5. orders 테이블에 외래 키를 두는 방법
<div align="center">
<img src="https://github.com/user-attachments/assets/61207515-0d15-4b96-b95d-58bffa0ed9a9">
</div>

   - 이 설계는 제약2, 제약3을 위반
      + 외래 키는 단일 행만 참조하는 제약 2를 위반
      + 컬럼은 원자적이어야 하는 제약 3을 위반

   - 제약 2, 제약 3을 만족하려면 다음과 같이 변경해야 함
<div align="center">
<img src="https://github.com/user-attachments/assets/801c8aba-b48c-43e4-938a-43da60da7dcd">
</div>

   - 하지만 이 설계는 제약 1을 위반
     + 기본 키는 반드시 유일해야 하므로 다음과 같이 100번 주문의 행을 더 늘릴 수는 없음
     + 기본 키는 반드시 유일해야 한다는 제약 1을 위반하기 때문에 적용할 수 없음

   - 따라서 orders 테이블에 외래 키를 둘 수 없음

6. product 테이블에 외래 키를 두는 방법
<div align="center">
<img src="https://github.com/user-attachments/assets/6d8439f3-ac74-4934-83fb-75695e911d4a">
</div>

   - 청바지는 주문 100, 101 두 번 주문
   - 이 설계는 제약 2, 제약 3을 위반
      + 외래 키는 단일 행만 참조하는 제약 2를 위반
      + 컬럼은 원자적이어야 하는 제약 3을 위반
   - 제약2, 제약3을 만족하려면 다음과 같이 변경
<div align="center">
<img src="https://github.com/user-attachments/assets/47c7dda5-c64f-4695-b6f0-7c5fe32310f7">
</div>

   - 하지만 이 설계는 제약 1을 위반
     + 기본 키는 반드시 유일해야 하므로 다음과 같이 1번 상품의 행을 더 늘릴 수는 없음
     + 기본 키는 반드시 유일해야 한다는 제약 1을 위반하기 때문에 적용할 수 없음
   - 따라서 product 테이블에 외래 키를 둘 수 없음

7. 결과적으로 product, orders 어디에 외래 키를 두더라도 관계형 데이터베이스의 기본 제약을 위반하게 되므로. 다대다 관계를 표현할 수 없음

-----
### 관계형 데이터베이스의 한계와 다른 패러다임
-----
1. 관계형 데이터베이스는 테이블 두 개만으로 다대다(M:N) 관계를 표현할 수 없음
   - 이처럼 테이블 두 개만으로는 양쪽의 '다(Many)' 관계를 모두 수용할 수 없는 것이 관계형 데이터베이스의 본질적인 한계
   - 그렇다고 일대다 관계에서 살펴봤던 것처럼, 하나의 컬럼에 여러 상품 ID를 쉼표로 구분해서 넣는 '1,2,3' 과 같은 방식은 제 1 정규형을 위반하고, 인덱스를 사용할 수 없음
   - 데이터 수정이 복잡해지는 등 모든 면에서 최악의 설계
   - 여러 컬럼(product_id_1, product_id_2 ...)을 두는 것 또한 확장성이 없고 문제가 많음
   - 이것이 바로 관계형 데이터베이스의 한계이자 특징

2. 테이블의 각 컬럼은 원자적인(atomic) 값 하나만 가져야 한다는 강력한 제약 덕분에 데이터 정합성을 지킬 수 있지만, 그 대가로 다대다 같은 유연한 관계는 직접 표현하지 못하는 것
   - 이것은 관계형 데이터베이스가 외래 키 하나로 단일 행을 가리키는 방식으로 관계를 맺기 때문에 발생하는 구조적인 한계
   - 다른 패러다임에서는 어떨까?
     + 자바(Java) 예시 : 자바와 같은 객체지향 언어는 다대다 관계를 매우 직관적으로 표현할 수 있음
 ```java
class Order {
     List<Product> products; // 주문은 상품 목록을 가진다.
}

class Product {
     List<Order> orders; // 상품은 주문 목록을 가진다.
}
```
   - 각 객체가 상대방 객체의 '목록(List)'을 직접 참조하
      + NoSQL (문서 데이터베이스) 예시 : MongoDB 같은 문서 데이터베이스에서는 하나의 '문서(Document)' 안에 다른 데이터를 배열 형태로 포함할 수 있어 M:N 관계를 비교적 쉽게 표현할 수 있음
 ```json
 // 주문(Order) 문서
 {
     "order_id": 1001,
     "ordered_at": "2025-08-15",
     "products": [ // 주문한 상품 정보를 배열로 포함
     {
        "product_id": 1, "name": "노트북", "price": 1500000
     },
     {
        "product_id": 5, "name": "마우스", "price": 25000
     }
     ]
 }
 ```
   - 이처럼 다른 패러다임에서는 다대다(M:N) 관계를 직접적으로 표현할 수 있지만, 관계형 데이터베이스에서는 불가능
